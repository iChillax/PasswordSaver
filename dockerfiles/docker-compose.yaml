services:

  # ollama:
  #   image: ollama/ollama:latest
  #   container_name: secrets_manager_ollama
  #   platform: linux/arm64
  #   ports:
  #     - "11434:11434"
  #   volumes:
  #     - ollama_data:/root/.ollama
  #   networks:
  #     - secrets_network
  #   environment:
  #     - OLLAMA_HOST=0.0.0.0:11434
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:11434/api/tags"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 5
  #     start_period: 30s

  backend:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: secrets_manager_backend
    platform: linux/arm64
    ports:
      - "8080:8080"
    environment:
      MONGODB_URI: mongodb://mongodb:27017
      MONGODB_DATABASE: password-saver
      ENCRYPTION_KEY: ${ENCRYPTION_KEY:-6AFD65C811E2FA7EE74A5C3B3BE59A5D19CCBB94ADEF3549733D261E2FD6F570}
      JWT_SECRET: ${JWT_SECRET:-50ccac8332e72363640552a68e6e1548}
      JWT_EXPIRATION: ${JWT_EXPIRATION:-24}
      # OLLAMA_API_URL: http://ollama:11434
      GIN_MODE: ${GIN_MODE:-debug}
    # depends_on:
      # mongodb:
        # condition: service_healthy
      # ollama:
      #   condition: service_healthy
    networks:
      - secrets_network
      - database_mongodb-network
    volumes:
      - ../backend:/app

  frontend:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    container_name: secrets_manager_frontend
    platform: linux/arm64
    ports:
      - "5173:5173"
    environment:
      VITE_API_URL: http://localhost:8080/api/v1
    depends_on:
      - backend
    networks:
      - secrets_network
    volumes:
      - ../frontend:/app
      - /app/node_modules
    command: npm run dev

volumes:
  mongodb_data:
  mongodb_config:
  ollama_data:

networks:
  secrets_network:
    driver: bridge
  database_mongodb-network:
    external: true
